<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calendar & Billing - Claim Cipher</title>
    <link rel="stylesheet" href="styles/pages.css">
    <link rel="stylesheet" href="styles/calendar.css">
</head>
<body class="master-interface" data-page="calendar">
    <header class="cipher-header">
        <div class="header-content">
            <div class="app-brand">
                <span class="logo">🎤</span>
                <span>Claim Cipher</span>
                <span class="version-tag">Professional Suite</span>
            </div>
            <nav class="master-tabs">
                <a href="dashboard.html" class="tab-btn" data-page="dashboard">
                    <span class="tab-icon">🏠</span>
                    <span class="tab-label">Dashboard</span>
                </a>
                <!-- Claims Workflow Order: Route → Mileage → Jobs → Calendar → Complete -->
                <a href="route-optimizer.html" class="tab-btn" data-page="route-optimizer">
                    <span class="tab-icon">🗺️</span>
                    <span class="tab-label">Routes</span>
                </a>
                <a href="mileage-calculator.html" class="tab-btn" data-page="mileage-calculator">
                    <span class="tab-icon">🧮</span>
                    <span class="tab-label">Mileage</span>
                </a>
                <a href="jobs.html" class="tab-btn" data-page="jobs">
                    <span class="tab-icon">💼</span>
                    <span class="tab-label">Jobs</span>
                </a>
                <a href="calendar.html" class="tab-btn active" data-page="calendar">
                    <span class="tab-icon">📅</span>
                    <span class="tab-label">Calendar</span>
                </a>
                <a href="total-loss.html" class="tab-btn" data-page="total-loss">
                    <span class="tab-icon">📋</span>
                    <span class="tab-label">Total Loss</span>
                </a>
                <!-- Supporting Tools -->
                <a href="analytics.html" class="tab-btn" data-page="analytics">
                    <span class="tab-icon">📊</span>
                    <span class="tab-label">Analytics</span>
                </a>
                <a href="firms.html" class="tab-btn" data-page="firms">
                    <span class="tab-icon">🏢</span>
                    <span class="tab-label">Firms</span>
                </a>
                <a href="help.html" class="tab-btn" data-page="help">
                    <span class="tab-icon">📚</span>
                    <span class="tab-label">Help</span>
                </a>
            </nav>
            
            <div class="user-section">
                <div class="user-info">
                    <div class="user-name" id="userName">Professional User</div>
                    <div class="user-role">Claims Specialist</div>
                </div>
                <button class="logout-btn cipher-btn cipher-btn--danger" onclick="handleLogout()">Logout</button>
            </div>
        </div>
    </header>

    <main class="master-content">
        <!-- Global Workflow Tracker Container -->
        <div class="workflow-tracker-container">
            <div class="workflow-tracker">
                <div class="workflow-step completed" data-step="route">Route</div>
                <div class="workflow-arrow">→</div>
                <div class="workflow-step completed" data-step="mileage">Mileage</div>
                <div class="workflow-arrow">→</div>
                <div class="workflow-step completed" data-step="jobs">Jobs</div>
                <div class="workflow-arrow">→</div>
                <div class="workflow-step active" data-step="calendar">Calendar</div>
                <div class="workflow-arrow">→</div>
                <div class="workflow-step" data-step="complete">Complete</div>
            </div>
        </div>
        
        <div class="tab-header">
            <h1>📅 Calendar & Billing</h1>
            <p>Schedule appointments, manage billing calendar, and export to external calendars</p>
        </div>
        
        <!-- Calendar Grid Layout -->
        <div class="calendar-grid-container">
            
            <!-- Left Panel: Calendar Navigation & Controls -->
            <div class="calendar-sidebar">
                <div class="calendar-controls">
                    <h3>📅 Calendar Controls</h3>
                    
                    <!-- Date Navigation -->
                    <div class="date-navigation">
                        <button class="nav-btn" id="prevMonth">‹</button>
                        <span class="current-month" id="currentMonth">January 2025</span>
                        <button class="nav-btn" id="nextMonth">›</button>
                    </div>
                    
                    <!-- Quick Actions -->
                    <div class="quick-actions">
                        <button class="calendar-action-btn" id="todayBtn">Today</button>
                        <button class="calendar-action-btn" id="scheduleBtn">Schedule Appointment</button>
                    </div>
                    
                    <!-- Calendar Filters -->
                    <div class="calendar-filters">
                        <h4>📋 View Options</h4>
                        <label class="filter-option">
                            <input type="checkbox" checked> Scheduled Appointments
                        </label>
                        <label class="filter-option">
                            <input type="checkbox" checked> Completed Jobs
                        </label>
                        <label class="filter-option">
                            <input type="checkbox" checked> Billing Due Dates
                        </label>
                        <label class="filter-option">
                            <input type="checkbox" checked> Firm Payment Dates
                        </label>
                    </div>
                </div>
                
                <!-- Export Options -->
                <div class="export-section">
                    <h3>📤 Export Calendar</h3>
                    <p>Export your schedule to external calendars</p>
                    
                    <div class="export-buttons">
                        <button class="export-btn google-export" id="exportGoogle">
                            <span class="export-icon">📅</span>
                            Google Calendar
                        </button>
                        <button class="export-btn apple-export" id="exportApple">
                            <span class="export-icon">🍎</span>
                            Apple Calendar
                        </button>
                        <button class="export-btn outlook-export" id="exportOutlook">
                            <span class="export-icon">📧</span>
                            Outlook
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- Center Panel: Main Calendar Display -->
            <div class="calendar-main">
                <div class="calendar-view" id="calendarView">
                    <!-- Calendar Grid will be generated here -->
                    <div class="calendar-loading">
                        <div class="loading-spinner"></div>
                        <p>Loading calendar...</p>
                    </div>
                </div>
            </div>
            
            <!-- Right Panel: Billing & Summary -->
            <div class="billing-sidebar">
                <div class="billing-summary">
                    <h3>💰 Billing Summary</h3>
                    
                    <!-- Monthly Totals -->
                    <div class="billing-totals">
                        <div class="total-card">
                            <div class="total-label">This Month</div>
                            <div class="total-amount" id="monthlyTotal">$0.00</div>
                        </div>
                        <div class="total-card">
                            <div class="total-label">Pending</div>
                            <div class="total-amount pending" id="pendingTotal">$0.00</div>
                        </div>
                        <div class="total-card">
                            <div class="total-label">Completed</div>
                            <div class="total-amount completed" id="completedTotal">$0.00</div>
                        </div>
                    </div>
                    
                    <!-- Firm Payment Schedule -->
                    <div class="payment-schedule">
                        <h4>🏢 Firm Payment Schedule</h4>
                        <div class="payment-list" id="paymentSchedule">
                            <!-- Payment items will be loaded here -->
                            <div class="no-payments">
                                <p>No scheduled payments</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Completed Jobs This Month -->
                    <div class="completed-jobs">
                        <h4>✅ Completed Jobs</h4>
                        <div class="completed-jobs-list" id="completedJobsList">
                            <!-- Completed jobs will be loaded here -->
                            <div class="no-completed-jobs">
                                <p>No completed jobs this month</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
        </div>
        
    </main>

    <!-- Schedule Appointment Modal -->
    <div class="schedule-modal" id="scheduleModal" style="display: none;">
        <div class="modal-overlay" onclick="closeScheduleModal()"></div>
        <div class="modal-content">
            <div class="modal-header">
                <h3>📅 Schedule Appointment</h3>
                <button class="modal-close" onclick="closeScheduleModal()">×</button>
            </div>
            <div class="modal-body">
                <form id="scheduleForm">
                    <div class="form-group">
                        <label for="appointmentDate">Date</label>
                        <input type="date" id="appointmentDate" required>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="appointmentTime">Time</label>
                            <input type="time" id="appointmentTime" required>
                        </div>
                        <div class="form-group">
                            <label for="appointmentDuration">Duration</label>
                            <select id="appointmentDuration">
                                <option value="30">30 minutes</option>
                                <option value="45" selected>45 minutes</option>
                                <option value="60">1 hour</option>
                                <option value="90">1.5 hours</option>
                                <option value="120">2 hours</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="appointmentAddress">Address</label>
                        <input type="text" id="appointmentAddress" placeholder="Property address" required>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="appointmentFirm">Firm</label>
                            <select id="appointmentFirm" required>
                                <option value="">Select Firm...</option>
                                <option value="state-farm">State Farm</option>
                                <option value="allstate">Allstate</option>
                                <option value="geico">GEICO</option>
                                <option value="progressive">Progressive</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="appointmentType">Claim Type</label>
                            <select id="appointmentType" required>
                                <option value="">Select Type...</option>
                                <option value="auto">Auto</option>
                                <option value="property">Property</option>
                                <option value="te">Total & Estimating</option>
                                <option value="photoscope">Photo/Scope</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="appointmentNotes">Notes</label>
                        <textarea id="appointmentNotes" placeholder="Appointment notes or special instructions" rows="3"></textarea>
                    </div>
                    
                    <div class="form-actions">
                        <button type="button" class="cancel-btn" onclick="closeScheduleModal()">Cancel</button>
                        <button type="submit" class="schedule-btn">Schedule Appointment</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="config/dev-config.js"></script>
    <script src="config/supabase-config.js"></script>
    <script src="config/api-config.js"></script>
    <script src="scripts/auth-service.js"></script>
    <script src="scripts/calendar-controller.js"></script>
    <script src="scripts/master-interface-controller.js"></script>
    
    <script>
        document.addEventListener('DOMContentLoaded', async function() {
            console.log('📅 Calendar page initialized');
            
            // Initialize master interface controller
            if (window.MasterInterfaceController) {
                window.masterInterface = new MasterInterfaceController();
            }
            
            // Initialize calendar controller
            if (window.CalendarController) {
                window.calendarController = new CalendarController();
                await window.calendarController.initialize();
            }
            
            window.handleLogout = function() {
                if (window.authService && window.authService.logout) {
                    window.authService.logout();
                }
                window.location.href = 'cipher-begins.html';
            };
        });
    </script>
</body>
</html>